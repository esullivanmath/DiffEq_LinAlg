\chapter{Linear and Nonlinear Systems of ODEs}
In this chapter we will consider qualitative and quantitative techniques for solving and
understanding systems of differential equations.  Systems arise naturally in many
settings, but let's set the stage with a motivating example.  In this example we will
built two differential equations that rely on each other.

\begin{example}\label{ex:upper_lower}
    A stream carries water at a rate of 50 gallons per minute first into the Upper Lake,
    then flows at this rate out of the Upper Lake and into the Lower Lake, then flows at
    this rate out of the Lower Lake. The Upper Lake is initially filled with 25,000
    gallons of pure water, and the Lower Lake is initially filled with 50,000 gallons of
    pure water. A chemical pollutant suddenly appears into the stream flowing into the
    Upper Lake with a concentration of 2.5 milligrams per gallon. Let $U(t)$ be the amount
    of the pollutant in the upper lake, and $L(t)$ be the amount of the pollutant in the
    lower lake.  Create a system of differential equations with initial conditions to
    model this scenario.\\
    {\bf Solution:} \\
    In each of the lakes we build a differential equation that models the conservation of
    mass of the pollutant.  The equations are all written in the form
    \[ \text{Rate of change of mass of pollutant} = \text{rate in} - \text{rate out}. \]
    By carefully tracking the units in the problem we arrive at the differential equations
    \begin{flalign*}
        \frac{dU}{dt} &= \left( 2.5 \frac{mg}{gal} \right) \left( 50 \frac{gal}{min}
        \right) - \left( \frac{U}{25000} \frac{mg}{gal} \right) \left( 50
        \frac{gal}{min} \right) \\
        \frac{dL}{dt} &= \left( \frac{U}{25000} \frac{mg}{gal} \right) \left( 50
        \frac{gal}{min}
        \right) - \left( \frac{L}{50000} \frac{mg}{gal} \right) \left( 50
        \frac{gal}{min} \right)
    \end{flalign*}
    with initial conditions $U(0) = 0$ milligrams and $L(0) = 0$ milligrams.
\end{example}

Notice in this example that the equation for the upper lake only involves the variable
$U$, but the equation for the lower lake depends on both $U$ and $L$.  In other words, to
be able to solve for both $U$ and $L$ we need to look at the interplay between the two
lakes.  In this case you may notice that we could just solve the $U$ equation on its own
(using separation of variables perhaps)
and then substitute the answer into the $L$ equation and solve what results (using
undetermined coefficients or integrating factors perhaps).  As we'll see, we won't be able to do this in
every system.

In this chapter we will build, analyze, solve, and explore similar systems of
differential equations.  Let's start with a familiar type of ODE: a second order
mass-spring oscillator.


\section{From Second Order ODE's to Systems}  


\begin{problem}
    Consider the differential equation
    \[ x'' + 3x' + 2x = 0. \]
    \begin{enumerate}
        \item[(a)] What is the characteristic polynomial for this differential equation?
        \item[(b)] What are the roots of the characteristic polynomial?
        \item[(c)] Based on the roots of the characteristic polynomial, how would you
            classify this differential equation? (undamped, underdamped, overdamped, or
            critically damped)
        \item[(d)] What is the basis for the solution space of this differential equation?
        \item[(e)] What is the general form of the solution to the differential equation?
    \end{enumerate}
\end{problem}
\solution{
    The characteristic polynomial is $r^2 + 3r + 2$ which factors nicely to $(r+1)(r+2)$.
    Therefore the roots are $r_1=-1$ and $r_2=-2$.  The basis for the solution space is
    $\mathcal{B} = \left\{ e^{-t} , e^{-2t} \right\}$.  This is an overdamped system with
    general solution
    \[ y(t) = C_1 e^{-t} + C_2 e^{-2t}. \]
}

\begin{problem}
    Let's consider the same differential equation
    \[ x'' + 3x' + 2x = 0, \]
    but this time we're going to do a little clever substitution to transform the problem
    into a different form.
    \begin{enumerate}
        \item[(a)] Let $y = x'$.  Taking the derivative of both sides of this substitution
            gives $y' = \underline{\hspace{1in}}$.
        \item[(b)] What is the physical meaning of $y$ in the context of this problem?
            (recall that $x$ is the displacement in a mass-spring oscillator)
        \item[(c)] What is the physical meaning of $y'$ in the context of this problem?
            (again recall that $x$ is the displacement in a mass-spring oscillator)
        \item[(d)] Rewrite the original differential equation using the substitutions from
            part (a): 
            $y=x'$ and $y'=x''$.
        \item[(e)] You should now have two differential equations.  The primary advantage
            you should find here is that both of the differential equations are first
            order (why is this an advantage?).  You should also notice that both
            differential equations are linear.
            \begin{flalign*}
                x' &= \underline{\hspace{1in}} \\
                y' &= \underline{\hspace{1in}}
            \end{flalign*}
        \item[(f)] Now let's leverage the language of linear algebra to rewrite this
            system of equations.
            \[ \begin{pmatrix} x' \\ y' \end{pmatrix} = \begin{pmatrix}
                    \underline{\hspace{0.5in}} & \underline{\hspace{0.5in}} \\
                \underline{\hspace{0.5in}} & \underline{\hspace{0.5in}} \end{pmatrix}
            \begin{pmatrix} x \\ y \end{pmatrix} \]
        \item[(g)] Find the characteristic polynomial for the matrix in part (f).  What do
            you notice?  What do you wonder?
        \item[(h)] What are the eigenvalues of the matrix in part (f)?  What do you
            notice?
    \end{enumerate}
\end{problem}
\solution{
    \begin{enumerate}
        \item[(a)] $y' = x''$
        \item[(b)] $y$ is the velocity of the moving mass.
        \item[(c)] $y'$ is the acceleration of the moving mass.
        \item[(d)] If $y = x'$ then $y' = x''$ and the differential equation becomes $y' +
            3y + 2x = 0$.  This can be rearranged to $y' = -2x - 3y$.
        \item[(e)] The differential equations are
            \begin{flalign*}
                x' &= y \\
                y' &= -2x - 3y
            \end{flalign*}
            There are several advantages here.  First of all we have now collapsed the
            second order differential equation to a first order differential equation.
            Furthermore, since these are linear differential equations we can use linear
            algebra to express the DE's in a more compact form (which is obviously not the
            only reason this is cool, but it certainly isn't a bad thing).
        \item[(f)] $\begin{pmatrix} x' \\ y\ \end{pmatrix} = \begin{pmatrix} 0 & 1 \\ -2 &
            -3 \end{pmatrix} \begin{pmatrix} x\\y\end{pmatrix}$.
        \item[(g)] The characteristic polynomial is the same as before: $r^2 + 3r + 2$.
        \item[(h)] The eigenvalues are the same as before: $r = -1,-2$.
    \end{enumerate}
}


\begin{problem}
   Consider the second order differential equation 
    \[ x'' + bx' + c x = 0 \]
    By substituting $y = x'$ we can get a system of differential equations.  What is the
    system, write it as a matrix equation, and what is the meaning of $y$ in this system? 
\end{problem}
\solution{
    \begin{flalign*}
        x' &= y \\
        y' &= -by-cx
    \end{flalign*}
    \[ \frac{d\bx}{dt} = \begin{pmatrix} 0 & 1 \\ -c & -b \end{pmatrix} \bx \]
}


\begin{thm}
    If we transform the second order differential equation $x'' + bx' + cx =0$ into the
    first order matrix equation $\begin{pmatrix} x' \\ y' \end{pmatrix} = \begin{pmatrix}
        0 & 1 \\ -c & -b \end{pmatrix} \begin{pmatrix} x \\ y \end{pmatrix}$ by making the
            substitution $y = x'$ then the roots of the characteristic polynomial $p(r) = r^2 +
            br + c$ are the same as the eigenvalues of the matrix in the first-order
            system.
\end{thm}
\begin{proof}
    (Prove this theorem)
%     Let $A = \begin{pmatrix} 0 & 1 \\ -c & -b \end{pmatrix}$ and observe that $\det(A
%         -\lambda I) = \lambda^2 + \lambda b + c$.  The result follows.  \\ (The reader
%         should fill in all of the details of this proof.) 
\end{proof}




\begin{problem}   
    If 
    \[ \left\{ \begin{array}{cl} x' &= y \\ y' &= -5x-2y \end{array} \right. \]
    then what was the mass-spring differential equation associated with the system?  Based
    on the eigenvalues of the associated matrix, is the mass-spring system undamped,
    underdamped, overdamped, or critically damped? Investigate the system using a tool
    like PPlane. Investigate the system using a tool like PPlane.
\end{problem}
\solution{
    \begin{flalign*}
        x'' + 2x'+5x=0
    \end{flalign*}
    Observe that $b^2-4mk = 4-4(5) < 0$ so the system is underdamped and will
    oscilalte.  Show in PPlane.
}


\begin{problem}
    In the previous problem you likely arrived at the second order differential equation
    $x'' + 2x' + 5x = 0$.  The discriminant on this differential equation is
    $b^2-4mk=4-4(1)(5)=-16$ so we know that the system is underdamped.  
    \begin{enumerate}
        \item[(a)] What are the roots of the characteristic polynomial.
        \item[(b)] Using the system in the previous problem write the associated matrix
            equation and find the eigenvalues of the matrix.  What do you notice?
        \item[(c)] Make a conjecture about the roots of the characteristic polynomial and
            the eigenvalues of the associated matrix.
    \end{enumerate}
\end{problem}

\begin{problem}
    Consider the second order differential equation modeling a spring-mass system: 
    \[ x'' + 2x' + 2x = 0. \]
    \begin{enumerate}
        \item[(a)] Find the discriminant, the roots of the characteristic polynomial,
            classify the system, and discuss the expected behavior.
            \solution{The system is underdamped since $b^2-4mk<0$.  Hence, the system will
            exhibit long-term damped oscillations.  The roots of the characteristic
        polynomial are 
        \[ r = \frac{-2 \pm \sqrt{4-4(1)(2)}}{2} = -1 \pm i \]
        }
        \item[(b)] Write the differential equation as a first order system and find the
            associated matrix equation.
            \solution{
            \[ \begin{pmatrix} x' \\ y' \end{pmatrix} = \begin{pmatrix} 0 & 1 \\ -2 & -2
                \end{pmatrix} \begin{pmatrix} x \\ y \end{pmatrix}. \]
            }
        \item[(c)] Find the eigenstructure of $A$ and discuss what this means about the
            behavior of the system.
    \end{enumerate}
\end{problem}

\newpage\section{Matrices and Linear Systems}

\begin{problem}
    Consider a two-tank system where brine is transferred between them according to the
    following rules.
    \begin{itemize}
        \item 20 L/min of fresh water enters Tank \#1
        \item Tank \#1 holds $x(t)$ kg of salt and holds a total of 100 liters of total
            mixture.
        \item Tank \#2 holds $y(t)$ kg of salt and holds a total of 200 liters of total
            mixture.
        \item Mixture runs from Tank \#1 to Tank \#2 at a rate of 30 L/min.
        \item Mixture runs from Tank \#2 to Tank \#1 at a rate of 10 L/min.
        \item Tank \#2 drains mixture at a rate of 20 L/min
    \end{itemize}
    Write a system of differential equations modeling the transfer of brine in this
    two-tank system.  What interesting questions can you ask about this system?  Finally,
    write the system as a matrix equation. You may want to investigate the system using
    software like \texttt{pplane}.
\end{problem}
\solution{
    \begin{flalign*}
        \frac{dx_1}{dt} &= \text{rate in from $x_2$} - \text{rate out to $x_2$} +
        \text{rate in from external} \\
        \frac{dx_2}{dt} &= \text{rate in from $x_1$} - \text{rate out to $x_1$} +
        \text{rate out to external} 
    \end{flalign*}
    Using concentrations in each we get
    \begin{flalign*}
        \frac{dx_1}{dt} &= -\frac{30}{100} x_1 + \frac{10}{200} x_2 + 0  =
        -\frac{3}{10} x_1 - \frac{1}{20}x_2 \\
        \frac{dx_2}{dt} &= \frac{30}{100} x_1 - \frac{10}{200} x_2 - \frac{20}{200} x_2 =
        \frac{3}{10} x_1 - \frac{3}{20} x_2
    \end{flalign*}
    Show using PPlane as well as get sketches of the time solutions.
}



\begin{problem}
    Three 100 gallon fermentation tanks are connected as shown below, and the mixtures in
    each tank are kept uniform by stirring.  Denote $x_j(t)$ as the amount of alcohol in
    tank $T_j$ at time $t$.  Suppose that the mixture circulates between the tanks at the
    rate of 10 gal/min.  What system of differential equations governs this closed system?
    Write the system as a matrix equation.
\end{problem}
\solution{
    \[ \frac{d\bx}{dt} = \frac{1}{10} \begin{pmatrix} -1 & 0 & 1 \\ 1 & -1 & 0 \\ 0 &
        1 & -1 \end{pmatrix} \bx \]
}
\begin{center}
    \begin{tikzpicture}
        \draw[black, thick] (0,0) node{Tank \#1} circle(1cm);
        \draw[black, thick] (5,0) node{Tank \#2} circle(1cm);
        \draw[black, thick] (2.5,3) node{Tank \#3} circle(1cm);
        \draw[->] (1.1,0) -- (3.9,0);
        \draw[->] (4.1,0.8) -- (3.1,2.1);
        \draw[->] (1.9,2.1) -- (0.9,0.8);
    \end{tikzpicture}
\end{center}



\begin{problem}
\item A coupled spring mass system is shown below.  Let $x_1(t)$ denote the displacement of
    mass 1 from its equilibrium and let $x_2(t)$ denote the displacement of mass 2 from
    its equilibrium.  Assuming no damping forces
    complete the system of differential equations below.


        \begin{center}
            \begin{tikzpicture}
                \tikzstyle{ground}=[fill,pattern=north east lines,draw=none,minimum width=0.3,minimum height=0.6]
                \tikzstyle{sky}=[fill,pattern=north east lines,draw=none,minimum width=0.3,minimum height=0.6]

                \node (wall1) [ground, minimum height=2cm] {};
                \draw (wall1.north east) -- (wall1.south east);
                \node [draw,minimum width=0.5cm,minimum height=0.5cm] (massF) at (3,0)
                {$M_1$};
                \node [draw,minimum width=0.5cm,minimum height=0.5cm] (massG) at (7,0)
                {$M_2$};
                \draw[decoration={aspect=0.3, segment length=3mm,
                amplitude=3mm,coil},decorate] (wall1.east) -- (massF);
                \draw[decoration={aspect=0.3, segment length=3mm,
                amplitude=3mm,coil},decorate] (massF.east) -- (massG.west);
%                 \draw [
%                     snake=coil,
%                     segment amplitude=5pt,
%                     segment length=5pt
%                 ] (wall1.east) -- (massF); 
%                 \draw [
%                     snake=coil,
%                     segment amplitude=5pt,
%                     segment length=5pt
%                 ] (massF.east) -- (massG.west); 
                \draw [
                    thick,
                    decoration={
                        brace,
                        mirror,
                        raise=0.5cm
                    },
                    decorate
                ] (wall1.east) -- (massF) 
                node [pos=0.5,anchor=north,yshift=-0.55cm] {$k1$}; 
                \draw [
                    thick,
                    decoration={
                        brace,
                        mirror,
                        raise=0.5cm
                    },
                    decorate
                ] (massF.east) -- (massG.west) 
                node [pos=0.5,anchor=north,yshift=-0.55cm] {$k2$}; 
            \end{tikzpicture}
        \end{center}
% 
%     \begin{center}
%         \includegraphics[width=0.6\columnwidth]{CoupledSpringMass}
%     \end{center}
    \begin{flalign*}
        m_1 x_1 '' &= -\underline{\hspace{0.5in}} x_1 + k_2 \underline{\hspace{0.5in}} \\
        m_2 x_2 '' &= -\underline{\hspace{0.5in}} \left( x_2 - x_1 \right)
    \end{flalign*}
    Once you have the system, write it as a matrix equation.
\end{problem}
\solution{
    \begin{flalign*}
        m_1 x_1 '' &= -k_1 x_1 + k_2 (x_2 - x_1) = -(k_1+k_2)x_1 + k_2 x_2 \\
        m_2 x_2 '' &= -k_2 \left( x_2 - x_1 \right) = k_2 x_1 - k_2 x_2
    \end{flalign*}
    \[ \frac{d^2 \bx}{dt^2} = \begin{pmatrix} -(k_1+k_2) & k_2 \\ k_2 & -k_2 \end{pmatrix}
    \bx \]
}

\begin{problem}
    The previous problem ended in a $2\times 2$ second order system.  Make an appropriate
    substitution and arrive at a $4\times 4$ first order system.  
\end{problem}
\solution{
Let $y_1 = x_1'$ and $y_2 = x_2'$.  Therefore,
\begin{flalign*}
    m_1 y_1' &= -(k_1+k_2)x_1 + k_2 x_2 \\
    x_1' &= y_1 \\
    m_2 y_2' &= k_2 x_1 - k_2 x_2\\
    x_2' &= y_2
\end{flalign*}
\[ \begin{pmatrix} y_1' \\ x_1' \\ y_2' \\ x_2' \end{pmatrix} = \begin{pmatrix} 0 &  -(k_1 +
        k_2) & 0 & k_2 \\
        1 & 0 & 0 & 0 \\
        0 & k_2 & 0 & -k_2 \\
        0 & 0 & 1 & 0 \end{pmatrix} \begin{pmatrix} y_1 \\ x_1 \\ y_2 \\ x_2 \end{pmatrix}
\]
}


% \begin{problem}
%     \begin{itemize}
%             \input{ClickerQuestions/DEQ.10.18.070}
%     \end{itemize}
% \end{problem}



\newpage\section{The Eigenvalue Method for Linear Systems}
Now let's interweave the idea of eigenvalues in with systems of differential equations. As
we already know, the eigenvalues and eigenvectors of a matrix $A$ tell us the underlying
structure of the matrix.  In some sense they are the DNA of the matrix.  In the cases that
we investigate here the eigen-structure of $A$ will tell us about the solution curves of
the linear first order differential equation.

\begin{problem}
    Let's return to the second order differential equation $x'' + 3x' + 2x = 0$.  Here is
    what we learned in the last section 
    \begin{itemize}
        \item we can rewrite this equation as the matrix equation
            \[ \begin{pmatrix} x' \\ y' \end{pmatrix} = \begin{pmatrix} 0 & 1 \\ -2 & -3
            \end{pmatrix} \begin{pmatrix} x \\ y \end{pmatrix}. \]
        \item the characteristic polynomial of the coefficient matrix is $p(\lambda) =
            \lambda^2 + 3\lambda + 2$ with roots $\lambda_1 = -1$ and $\lambda_2 = -2$.  
        \item the eigenvalues are the same as the roots to the characteristic polynomial
            $p(r)= r^2 + 3r + 2$ found by guessing that $x(t) = e^{rt}$ is a solution to
            the differential equation
    \end{itemize}
    Now let's take this a bit further:\\
    The eigen-pairs of the coefficient matrix are
    \[ \lambda_1 = -1 \text{ with } \bv_1 = \begin{pmatrix} -1 \\ 1 \end{pmatrix} \]
    \[ \lambda_2 = -2 \text{ with } \bv_1 = \begin{pmatrix} -1 \\ 2 \end{pmatrix} \]
    \begin{enumerate}
        \item[(a)] Verify that the the vector $e^{-1 t} \begin{pmatrix} -1 \\
                1\end{pmatrix}$
            is a solution to the matrix form of the differential equation by substituting
            it into both sides.
        \item[(b)] Verify that the the vector $e^{-2 t} \begin{pmatrix} -1 \\
                2\end{pmatrix}$
            is a solution to the matrix form of the differential equation by substituting
            it into both sides.
        \item[(c)] What do you notice from the answers to parts (a) and (b)?
        \item[(d)] Since this is a linear differential equation and we have two linearly
            independent solution vectors, we can write the general solution to this
            differential equation as
            \[ \begin{pmatrix} x\\y\end{pmatrix} = C_1 e^{\underline{\hspace{0.25in}} t}
                \begin{pmatrix} \underline{\hspace{0.25in}} \\ \underline{\hspace{0.25in}}
                \end{pmatrix} + C_2 e^{\underline{\hspace{0.25in}} t}
                \begin{pmatrix} \underline{\hspace{0.25in}} \\ \underline{\hspace{0.25in}}
            \end{pmatrix} \]
    \end{enumerate}

\end{problem}

\begin{thm}\label{thm:eigen_ode}
    Let $\lambda$ be an eigenvalue of the matrix $A$ for the first
    order linear system 
    \[ \frac{d\bx}{dt} = A \bx. \]
    If $\bv$ is an eigenvector associated with eigenvalue $\lambda$ then 
    \[ \bx(t) = \bv e^{\lambda t} \]
    is a nontrivial solution of the system.
\end{thm}
\begin{proof}
    Let $A$ be a real square matrix and let $\bv$ and $\lambda$ be an eigen-pair for $A$.
    To check that $\bx = \bv e^{\lambda t}$ is a solution to the differential equation
    $\bx' = A\bx$ we substitute $\bx$ in on both sides and check.

    On the left-hand side of the differential equation we get
    \begin{flalign*}
        \frac{d\bx}{dt} = \frac{d}{dt} \left( \bv e^{\lambda t} \right) 
        = \bv \frac{d}{dt} \left( e^{\lambda t} \right) 
        = \bv \left( \lambda e^{\lambda t} \right) 
        = \lambda e^{\lambda t} \bv.
    \end{flalign*}
    On the right-hand side of the differential equation we get
    \begin{flalign*}
        A\bx = A \left( \bv e^{\lambda t} \right) 
        = e^{\lambda t} A \bv 
        = e^{\lambda t} \left( \lambda \bv \right) 
        = \lambda e^{\lambda t} \bv \quad \checkmark.
    \end{flalign*}
\end{proof}

\begin{thm}
    If $\bv_1, \bv_2, \dots, \bv_k$ are unique solutions to the first
    order linear system of equations
    $\bx'=A\bx$ then a linear combination 
    \[ \bv = \sum_{j=1}^k c_j \bv_j \]
    is also a solution of $\bx' = A \bx$.
\end{thm}
\begin{proof}
    Since the differential equation is linear we know that a linear combination of
    solutions is also a solution.  
\end{proof}

\begin{thm}
    If the matrix $A$ has eigenvectors $\bv_1, \bv_2, \ldots, \bv_n$ and associated
    eigenvectors $\lambda_1, \lambda_2, \ldots, \lambda_n$ then the general solution to
    the differential equation $\bx' = A \bx$ is
    \[ \bx(t) = \underline{\hspace{2in}} \]
\end{thm}
\begin{proof}
    (Fill in the blank above and prove the theorem)
\end{proof}
\solution{
    \[ \bx(t) =c_1 \bv_1 e^{\lambda_1 t} +c_2 \bv_2 e^{\lambda_2 t} + \cdots +c_k \bv_k
    e^{\lambda_k t} \]
    This follows immediately from the previous two theorems.
}

% \begin{problem}
%     Considering the previous two theorems, if
%     \[ \frac{d\bx}{dt} = A \bx \]
%     then what is the solution to the system?
% \end{problem}

\begin{problem}
    Solve the following linear system of differential equations.
    \begin{flalign*}
        x_1' &= 4x_1 - x_2 \\
        x_2' &= 2x_1 + x_2
    \end{flalign*}
    with initial conditions $x_1(0) = 1$ and $x_2(0) = 3$. Complete the problem by giving a plots
    $x_1$ vs $t$, $x_2$ vs $t$, and $x_2$ vs $x_1$.  Use technology to find the
    eigen-structure of the resulting matrix and to create the plots.
\end{problem}
\solution{
First write the system as a matrix equation $\bx' = A \bx$:
\[ \bx' = \begin{pmatrix} 4 & -1 \\ 2 & 1 \end{pmatrix} \bx. \]
Now observe that the eigen-pairs of $A$ are
\[ \bv_1 = \begin{pmatrix} 1\\2 \end{pmatrix} \text{ with } \lambda_1 = 2 \quad \text{and}
\quad \bv_2 = \begin{pmatrix}1\\1\end{pmatrix} \text{ with } \lambda_2 = 3. \]
Hence, the solution to the differential equation is
\[ \bx(t) = c_1 e^{2t} \begin{pmatrix} 1 \\ 2\end{pmatrix} + c_2 e^{3t} \begin{pmatrix} 1
    \\ 1 \end{pmatrix}. \]
To find the values of the constants we need to solve the system
\[ \begin{pmatrix} 1\\3\end{pmatrix} = c_1 \begin{pmatrix}1\\2\end{pmatrix} + c_2
\begin{pmatrix}1\\1\end{pmatrix}. \]
Augmenting and row reducing gives
\[ \left( \begin{array}{cc|c} 1&1&1\\2&1&3\end{array} \right) \to \left(
\begin{array}{cc|c} 1 & 1 & 1 \\ 0 & -1 & 1 \end{array} \right) \to \left(
\begin{array}{cc|c} 1 & 0 & 2 \\ 0 & 1 & -1 \end{array} \right). \]
so $c_1 = 2$ and $c_2 = -1$ and the full solution is
\[ \bx(t) = 2 e^{2t} \begin{pmatrix} 1 \\ 2\end{pmatrix} - e^{3t} \begin{pmatrix} 1
    \\ 1 \end{pmatrix}. \]

\begin{center}
    \begin{tikzpicture}
        \begin{axis}[axis lines=center, domain=0:1.5, xmin=0, xmax=1.5, grid]
            \addplot[smooth, very thick, blue] {2*exp(2*x) - exp(3*x)};
            \addplot[smooth, very thick, red] {4*exp(2*x) - exp(3*x)};
        \end{axis}
    \end{tikzpicture}
\end{center}
}

% \begin{problem}
%     \begin{itemize}
%             \input{ClickerQuestions/DEQ.10.20.030}
%     \end{itemize}
% \end{problem}


\begin{problem}
    Since we know that both $x_1=x_2=e^{3t}$ and $x_1=e^{-t}, x_2=-e^{-t}$ are solutions
    to the system 
    \begin{flalign*} 
        x_1' & =  x_1  +2x_2 \\ x_2' & = & 2x_1  + x_2 \\
    \end{flalign*} 
    Which of the following are also solutions?
\begin{enumerate}
    \item[(a)] 
\begin{flalign*}
    x_1 & =  3e^{3t}-e^{-t} \\
    x_2 & =  3e^{3t}+e^{-t} \\
  \end{flalign*} 
\item[(b)] 
\begin{flalign*}
    x_1 & =  -e^{3t}-e^{-t} \\
    x_2 & =  -e^{3t}+e^{-t} \\
  \end{flalign*} 

\item[(c)] 
\begin{flalign*}
     x_1 & =  2e^{3t}+4e^{-t} \\
    x_2 & = -4e^{-t}+2e^{3t} \\
  \end{flalign*} 

\item[(d)] 
\begin{flalign*}
    x_1 & =  0 \\
    x_2 & =  0 \\
\end{flalign*} 

\item[(e)] None of the above

\item[(f)] All of the above.

\end{enumerate}


\end{problem}
% \begin{problem}
%     \begin{itemize}
%             \input{ClickerQuestions/DEQ.10.20.040}
%     \end{itemize}
% \end{problem}



\begin{problem}
    Consider the system of differential equations,

\[
y'(t) = \left( 
\begin{array}{ccc}
14 & 0 & -4 \\
2 & 13 & -8 \\
-3 & 0 & 25 \\
\end{array}
\right) y(t)
\].

Which of the following functions solve this system?
\begin{enumerate}
    \item[(a)]
        $y(t) = \left( \begin{array}{c} 1 \\ 0 \\ 3 \\ \end{array} \right) e^{-4 t}$
    \item[(b)]
        $y(t) = \left( \begin{array}{c} 1 \\ 3 \\ 2 \\ \end{array} \right) e^{6 t}$
    \item[(c)]
        $y(t) = \left( \begin{array}{c} 4 \\ 0 \\ 1 \\ \end{array} \right) e^{13 t}$
    \item[(d)] None of the above
    \item[(e)] All of the above.
\end{enumerate}

\end{problem}
% \begin{problem}
%     \begin{itemize}
%             \input{ClickerQuestions/DEQ.10.20.050}
%     \end{itemize}
% \end{problem}

% \begin{problem}
%     \begin{itemize}
%             \input{ClickerQuestions/DEQ.10.22.100}
%     \end{itemize}
% \end{problem}

\begin{problem}\label{prob:linear_fighting}
    Two forces are fighting one another. Let $x$ and $y$ be the number of soldiers in each
    force and let $a$ and $b$ be the offensive fighting capacities of $x$ and $y$ respectively.
    Assume that forces are lost only to combat, and no reinforcements are brought in.
    \begin{enumerate}
        \item[(a)] Write a system of differential equations that models this scenario.
            Write the system as a matrix equation.
        \item[(b)] Solve the system using the eigenvalue method using sensible initial
            conditions and values for $a$ and $b$.
        \item[(c)] Determine values of $a$ and $b$ for which army $x$ wins and for which
            army $y$ wins.
    \end{enumerate}
\end{problem}


\begin{problem}\label{prob:linear_fighting_nonhom}
    In Problem \ref{prob:linear_fighting} we built a model that might be really good for
    hand-to-hand combat.  Let's tweak this model.
    \begin{enumerate}
        \item[(a)] Modify the model from Problem \ref{prob:linear_fighting} to allow each
            army to get a constant number of recruits each day (assume time is measured in
            days).
        \item[(b)] Propose a solution technique for this model and implement it.
        \item[(c)] Propose a way to find a steady state solution to your model (if it
            exists) and implement your idea.
    \end{enumerate}
\end{problem}

% \begin{problem}
%     \begin{itemize}
%             \input{ClickerQuestions/DEQ.10.19.010}
%     \end{itemize}
% \end{problem}

In a linear system where there is a constant non-homogeneity we need to modify our solution
technique.  Consider the system of differential equations
\begin{flalign}
    \bx'(t) = A \bx + \bb
    \label{eqn:nonhomog_linear_system}
\end{flalign}
where $\bx$ is a vector of functions, $A$ is a real matrix, and $\bb$ is a vector of
constants.  Problem \ref{prob:linear_fighting_nonhom} should result in a model of this
type and in that problem you proposed a solution technique and a method for finding the
steady-state solution.  Now let's summarize these techniques.
\begin{technique}
    Let $\bx$ be an $n\times n$ vector of single variable functions, let $A$ be an $n\times n$ real matrix, and let
    $\bb$ be an $n \times n$ real vector.  Consider the system of $n$ differential
    equations
    \[ \bx' = A \bx + \bb \]
    with initial conditions $\bx(0) = \bx_0$. Observe that this is a non-homogeneous
    differential equation with a constant non-homogeneity.  The general solution
    to the differential equation is
    \[ \bx(t) = \underline{\hspace{2in}} \]
    where \ldots (complete the technique)
\end{technique}
\solution{
    \[ \bx(t) = \sum_{j=1}^n c_j \left( \bv_j e^{\lambda_j t} \right) + \bw \]
    where $\bw$ is the steady state vector resulting from solving the equation $A \bw +
    \bb = \bo$ and the constants arise from the equation $\bx_0 - \bw = \sum_{j=1}^n c_j \bv_j$
}

\begin{problem}
    Consider the linear system of differential equations given by
    \[ \begin{pmatrix} x' \\ y' \end{pmatrix} = \begin{pmatrix} -3 & 1 \\ 0 & -3
        \end{pmatrix} \begin{pmatrix} x \\ y \end{pmatrix} + \begin{pmatrix} 3 \\ 6
    \end{pmatrix} \]
    with initial conditions $x(0) = 1$ and $y(0) = 0$.  Solve the system of equations,
    generate a plot of the solution, and find the steady state (if it exists).
\end{problem}

\begin{problem}
    Solve the second order differential equation $y'' + 4y' + 3y = 2$ by converting to a
    first order system.  Find the equilibrium if it exists.
\end{problem}
\solution{
Partial solution:\\
Let $x = y'$ and we can rewrite as
\begin{flalign*}
    x' &= -4y + 3x + 2 \\
    y' &= x
\end{flalign*}
which can be rewritten as 
    \[ \begin{pmatrix} x' \\ y' \end{pmatrix} = \begin{pmatrix} 3 & -4 \\ 1 & 0
        \end{pmatrix} \begin{pmatrix} x \\ y \end{pmatrix} + \begin{pmatrix} 2 \\ 0
    \end{pmatrix} \]
    The equilibrium can be found by solving
    \[ \begin{pmatrix} 0 \\ 0 \end{pmatrix} = \begin{pmatrix} 3 & -4 \\ 1 & 0
        \end{pmatrix} \begin{pmatrix} x \\ y \end{pmatrix} + \begin{pmatrix} 2 \\ 0
    \end{pmatrix} \]
}

\begin{problem}
    Return to the ``Upper and Lower Lake'' Example \ref{ex:upper_lower} and solve the
    system of equations with the tools discussed in this section.
\end{problem}


\begin{problem}
    Four ants are initially on the grid points $(0,0)$, $(1,0)$, $(1,1)$, and $(0,1)$.
    All four ants follow the strange behavior where their current velocity vector is
    always proportional to the vector that 
    points at the ant $90^\circ$ to their right.   For example, if the ant starting at $(0,0)$ is
    called ``ant 1'' and has position $(x_1,y_1)$ then it's velocity vector is given as 
    \[ \left( \frac{dx_1}{dt} \, , \, \frac{dy_1}{dt} \right) = k \left[ \left( x_2 \, , \, y_2
    \right) - \left( x_1 \, , \, y_1 \right) \right] \]
    where $(x_2, y_2)$ is the current location of the ant that started at $(1,0)$ and $k$
    is the proportionality constant that dictates the speed of the ant.
    Therefore there are two differential equations for the first ant:
    \begin{flalign*}
        \frac{dx_1}{dt} &= k(x_2 - x_1) \\
        \frac{dy_1}{dt} &= k(y_2 - y_1)
    \end{flalign*}
    \begin{enumerate}
        \item[(a)] Complete the system of differential equations by writing two equations
            for each additional ant.
        \item[(b)] Write the system of 8 differential equations as a matrix equation.
        \item[(c)] Before solving this system you should stop and sketch what the
            expected solution should look like.  You should have four expected
            trajectories -- one for each ant.  Do you expect there to be a steady state?
            Do you expect there to be a point where the ants converge or do you expect the
            ants to diverge from each other?  
        \item[(d)] Write code to get an approximate solution using Euler's method.
        \item[(e)] Find the eigenvectors and eigenvalues of the coefficient matrix and use
            them to write the full solution to the system of equations.  (note that it is
            entirely possible that some of the eigenvectors and eigenvalues are complex
            \ldots what does this mean in this context?)
        \item[(f)] Write code to build an animated solution to the system of equations.
        \item[(g)] Now for the fun part.  Extend your system from part (b) and your code
            from part (d) or part (f) to allow for $n$ ants who's starting positions are uniformly
            distributed along the circumference of a unit circle.  Animate your solution
            with several different values of $n$.
    \end{enumerate}
\end{problem}




\newpage\section{The Matrix Exponential}
Recall that if we are solving the first order linear homogeoneous differential equation
$x' = rx$ we know (from separation of variables) that the solution is $x(t) = x_0 e^{rt}$.
This is one of the simplest ordinary differential equation that there is!  In this chapter we
have encountered linear systems of differential equations that have a very similar form:
\begin{flalign}
    \bx' = A \bx
    \label{eqn:linear_system_matrix_eqn}
\end{flalign}
where $\bx$ this time is a vector of functions and $A$ is a matrix of values.  More
clearly, if $A$ is an $n \times n$ real matrix then a linear system of differential
equations can be written as
\[ \begin{pmatrix} x_1'(t) \\ x_2'(t) \\ \vdots \\ x_n'(t) \end{pmatrix} = \begin{pmatrix}
        a_{11} & a_{12} & \cdots & a_{1n} \\
        a_{21} & a_{22} & \cdots & a_{2n} \\
    \vdots & \vdots & \ddots & \vdots \\
a_{n1} & a_{n2} & \cdots & a_{nn} \end{pmatrix} \begin{pmatrix} x_1(t) \\ x_2(t) \\ \vdots
\\ x_n(t) \end{pmatrix}. \]
It stands
to reason that the solution to \eqref{eqn:linear_system_matrix_eqn} should be the same, or
at least have the same form, as the solution to the simple differential equation $x' =
rx$.  Hence we conjecture that the solution to \eqref{eqn:linear_system_matrix_eqn} is
\begin{flalign}
    \bx = e^{A t} \bx_0
    \label{eqn:linear_system_matrix_eqn_soln}
\end{flalign}
where $\bx_0$ is the vector of initial conditions. \ldots but wait!  What is $e^{At}$?
That's right, we have a matrix in the exponent of an exponential function!

To understand the matrix exponential we first start by recalling the Taylor series of the
exponential function
\[ e^x = 1 + x + \frac{x^2}{2} + \frac{x^3}{3!} + \frac{x^4}{4!} + \cdots. \]
If instead we examine the function $f(x) = e^{ax}$ where $a \in \mathbb{R}$ then it is
easy to see that
\[ e^{ax} = 1 + ax + a^2 \frac{x^2}{2} + a^3 \frac{x^3}{3!} + a^4 \frac{x^4}{4!} + \cdots.
\]

If we use the Taylor series as the definition of the exponential function then a natural
definition for the matrix exponential is as follows.
\begin{definition}[Matrix Exponential]
    Let $A$ be a square matrix and $t$ be a real variable.  The matrix exponential
    $e^{At}$ is defined as
    \begin{flalign}
        e^{At} = I + At + A^2 \frac{t^2}{2} + A^3 \frac{t^3}{3!} + A^4 \frac{t^4}{4!} +
        \cdots.
        \label{eqn:matrix_exponential_Taylor}
    \end{flalign}
\end{definition}
Recall that if $A$ has a complete collection of eigenvalues and eigenvectors
then we can find matrices $P$ and $D$ such that $A = PDP^{-1}$.  Therefore the definition
of the matrix exponential can be rewritten as
\begin{flalign}
    \notag e^{At} &= I + PDP^{-1}t + PD^2P^{-1} \frac{t^2}{2} + PD^3P^{-1} \frac{t^3}{3!} +
    PD^4P^{-1} \frac{t^4}{4!} + \cdots \\
    &= P \left(  I + Dt + D^2 \frac{t^2}{2} + D^3 \frac{t^3}{3!} + D^4 \frac{t^4}{4!} +
    \cdots \right) P^{-1} 
    \label{eqn:matrix_exponential_Taylor_Eigen}
\end{flalign}


Using either \eqref{eqn:matrix_exponential_Taylor} or
\eqref{eqn:matrix_exponential_Taylor_Eigen} we now have a way to find the analytic
solution to a linear homogeneous system of differential equations of the form $\bx' = A
\bx$.  

\begin{thm}\label{thm:system_soln_matrix_exp}
    If $\bx$ is a vector of functions and $A$ is a real square matrix then the solution to
    the differential equation $\bx' = A \bx$ is
    \[ \bx(t) = e^{At} \bx_0. \]
\end{thm}

The computation of the matrix exponential in Theorem \ref{thm:system_soln_matrix_exp} is
potentially really obnoxious by hand, but thankfully there are built-in tools for
performing the computation in the most scientific computing software.  For example, in
MATLAB you can use the command \mcode{expm(A)} to find the matrix exponential of the matrix
$A$.

\begin{example}
    Use the matrix exponential to solve the system of differential equations 
    \[ \bx'(t) = \begin{pmatrix} 2 & 0 \\ 1 & 2 \end{pmatrix} \bx(t) \quad \text{with}
        \quad \begin{pmatrix} x_1(0) \\ x_2(0) \end{pmatrix} = \begin{pmatrix} 2 \\ -3
    \end{pmatrix} \]
    {\bf Solution:} The following MATLAB code finds the matrix exponential
\begin{lstlisting}
clear; clc;
syms t
A = [2 , 0 ; 1 , 2];
x0 = [2;-3];
x = expm(A*t) * x0   % this is the solution to the system of ODEs
\end{lstlisting}
    which results in the solution 
    \[ \begin{pmatrix} x_1(t) \\ x_2(t) \end{pmatrix} = \begin{pmatrix} e^{2t} & 0 \\
        te^{2t} & e^{2t} \end{pmatrix} \begin{pmatrix} 2 \\ -3 \end{pmatrix}. \]
    pulling this out of matrix form we have
    \[ x_1(t) = 2e^{2t} \quad \text{and} \quad x_2(t) = 2te^{2t} - 3e^{2t}. \]
    Finally we can plot the solution with the following code.
\begin{lstlisting}
tmax = 1;
ezplot(x(1),[0,tmax])
hold on
ezplot(x(2),[0,tmax])
axis([0,1,-10,10])
\end{lstlisting}
\end{example}
Hint: You can use
the command \mcode{latex(simplify(x))} to take your symbolic answer for $\bx(t)$ from MATLAB and get it into \LaTeX.

The following two problems give you a chance to practice using the matrix exponential to
solve applied systems of differential equations problems.  Have fun!!

\begin{problem}
    Tank \#1 is connected to Tank \#2 by two separate pipes.  Pure water is flowing
    into Tank \#1 at a rate of 2 gallons per minute.  Tank \#1 is initially filled with 50
    gallons of water with 5 pounds of salt dissolved in it.  Tank \#2 contains 40 gallons
    of water with 1 pound of salt dissolved in it.  Solution flows from Tank \#1 to Tank
    \#2 at a rate of 3 gallons per minute and from Tank \#2 to Tank \#1 at a rate of 1
    gallon per minute.  Thoroughly mixed solution is also being drained from Tank \#2 at a
    rate of 2 gallons per minute.  Let $x(t)$ be the amount of salt in Tank \#1 and let
    $y(t)$ be the amount of salt in Tank \#2 at time $t$.  
    \begin{enumerate}
        \item[(a)] Write the linear system of differential equations that models this
            scenario. Be sure to include your initial conditions (it may help to draw a
            picture first).
        \item[(b)] Solve the system of differential equations using the matrix
            exponential.  Clearly write your answer in matrix and  vector form.
        \item[(c)] Solve the system again using the eigenvalue method.  Clearly write your
            answer showing how the eigenvalues and eigenvectors play a role in the
            solution.
        \item[(d)] Make a plot showing how the two concentrations evolve over 100 minutes.
    \end{enumerate}
\end{problem}




\begin{problem}
    You are given a mechanical system with three springs $A$, $B$, and $C$ and two
    objects $F$ and $G$ each of mass $M$.  Springs $A$ and $C$ have spring constant
    $k$ and spring $B$ has spring constant $2k$.  Spring $A$ is attached to a wall on
    the left and spring $C$ is attached to a wall on the right. Let $x_1(t)$ be the
    position of $F$ from it's equilibrium ($x_1=0$ indicates that $F$ is at
    equilibrium), and let $x_2(t)$ be the position of $G$ from it's equilibrium.  See
    Figure \ref{fig:double_spring_mass}.
    \begin{figure}[ht!]
        \begin{center}
            \begin{tikzpicture}
                \tikzstyle{ground}=[fill,pattern=north east lines,draw=none,minimum width=0.3,minimum height=0.6]
                \tikzstyle{sky}=[fill,pattern=north east lines,draw=none,minimum width=0.3,minimum height=0.6]

                \node (wall1) [ground, minimum height=2cm] {};
                \draw (wall1.north east) -- (wall1.south east);
                \node [draw,minimum width=0.5cm,minimum height=0.5cm] (massF) at (3,0) {$F$};
                \node [draw,minimum width=0.5cm,minimum height=0.5cm] (massG) at (5,0) {$G$};
                \node (rightend) at (8,0) [sky,minimum height=2cm] {};
                \draw (rightend.south west) -- (rightend.north west);
                \node (fix) at (0,0) {};
                \draw[decoration={aspect=0.3, segment length=3mm,
                amplitude=3mm,coil},decorate] (wall1.east) -- (massF);
                \draw[decoration={aspect=0.3, segment length=3mm,
                amplitude=3mm,coil},decorate] (massF.east) -- (massG.west);
                \draw[decoration={aspect=0.3, segment length=3mm,
                amplitude=3mm,coil},decorate] (massG.east) -- (rightend.west);
%                 \draw [
%                     snake=coil,
%                     segment amplitude=5pt,
%                     segment length=5pt
%                 ] (wall1.east) -- (massF); 
%                 \draw [
%                     snake=coil,
%                     segment amplitude=5pt,
%                     segment length=5pt
%                 ] (massF.east) -- (massG.west); 
%                 \draw [
%                     snake=coil,
%                     segment amplitude=5pt,
%                     segment length=5pt
%                 ] (massG.east) -- (rightend.west); 
                \draw [
                    thick,
                    decoration={
                        brace,
                        mirror,
                        raise=0.5cm
                    },
                    decorate
                ] (wall1.east) -- (massF) 
                node [pos=0.5,anchor=north,yshift=-0.55cm] {$A$}; 
                \draw [
                    thick,
                    decoration={
                        brace,
                        mirror,
                        raise=0.5cm
                    },
                    decorate
                ] (massF.east) -- (massG.west) 
                node [pos=0.5,anchor=north,yshift=-0.55cm] {$B$}; 
                \draw [
                    thick,
                    decoration={
                        brace,
                        mirror,
                        raise=0.5cm
                    },
                    decorate
                ] (massG.east) -- (rightend) 
                node [pos=0.5,anchor=north,yshift=-0.55cm] {$C$}; 
            \end{tikzpicture}
        \end{center}
        \caption{Double spring mass system}
        \label{fig:double_spring_mass}
    \end{figure}
    
    Initial conditions: Assume that we move mass $F$ exactly 1 unit to the
            left and let it go.  This means that $x_1(0) = -1$ and $x_3(0) = x_1'(0) = 0$.
            If we initially hold mass $G$ fixed then $x_2(0)=x_4(0)=0$.    
    \begin{enumerate}
        \item[(a)] First we'll write the second order linear system of equations.  This system of
            equations is just a statement of Hooke's law for springs: $F = -kx$, where $k$ is
            the spring constant.  To help you get
            started you can use the skeleton below:
            \begin{flalign*}
                M x_1'' &= -k x_1 + \left( \text{some spring constant} \right) \left(
                \text{distance between $x_2$ and $x_1$}
                \right) \\
                M x_2'' &= -2k \left( x_2 - x_1 \right) - \left( \text{some spring constant}
                \right) x_2
            \end{flalign*}


        \item[(b)] To turn this into a first-order system we introduce two new variables: $x_3 =
            x_1'$ and $x_4 = x_2'$.  Write this system of differential equations \dots I'll
            get you started \dots
            \begin{flalign*}
                x_1' &= x_3 \\
                x_2' &= x_4 \\
                x_3' &= \text{ \dots } \\
                x_4' &=  \text{ \dots }
            \end{flalign*}
            Now write the system as a matrix equation of the form $\frac{d\bx}{dt} = A \bx$.

        \item[(c)] Solve the linear system of differential equations with the method of
            matrix exponentials.
        \item[(d)] Next solve the linear system of differential equations with the
            eigenvalue method. You {\it should} find that you have 4 purely imaginary
            eigenvalues (I'll wait while you let MATLAB find these for you \dots).  This
            means that you will have oscillations in your solutions. Why?
%         
% 
%         
%         Hence, if we let $\lambda_j = \alpha_j
%         i$ then $e^{\lambda_j t} = \cos(\alpha_j t) + i\sin(\alpha_j t)$ by Euler's
%         formula.  Therefore, the solution to the system of differential equations becomes
%         \begin{flalign*} \bx(t) &= \left( A_1 \cos(\alpha_1 t) + B_1 \sin(\alpha_1 t)
%             \right) \bv_1 \\
%             &\quad+\left( A_2 \cos(\alpha_2 t) + B_2 \sin(\alpha_2 t) \right) \bv_2 \\
%             &\quad+\left( A_3 \cos(\alpha_3 t) + B_3 \sin(\alpha_3 t) \right) \bv_3 \\
%             &\quad+\left( A_4 \cos(\alpha_4 t) + B_4 \sin(\alpha_4 t) \right) \bv_4.
%         \end{flalign*}
%         You should have values of $\alpha_1, \alpha_2, \alpha_3,$ and $\alpha_4$ as well
%         as the eigenvectors $\bv_1, \bv_2, \bv_3$, and $\bv_4$.

        \item[(e)] Plot your solutions.
    \end{enumerate}
\end{problem}


\newpage\section{Complex Eigenvalues for Linear Systems of ODEs}
In this brief section we consider the case where the eigenvalues of the coefficient matrix
in a linear system are complex.  If $\bx' = A \bx$ and $A$ has complex eigenvalues
$\lambda = \alpha \pm \beta i$ then the solution to the system is
\[ \bx(t) = C_1 e^{\lambda_1 t} \bv_1 + C_2 e^{\lambda_2 t} \bv_2 = e^{\alpha t} \left(
C_1 e^{\beta i t} \bv_1 + C_2 e^{-\beta i t} \bv_2 \right). \]
If we use Euler's formula for the complex exponentials the solution becomes
\[ \bx(t) = e^{\alpha t} \left( C_1 \left( \cos(\beta t) + i\sin(\beta t) \right) \bv_1 +
C_2 \left( \cos(\beta t) - i\sin(\beta t) \right) \bv_2 \right). \]
Now if we gather the trigonometric functions the solution can be written as
\begin{flalign} \bx(t) = e^{\alpha t} \left[ \left( C_1 \bv_1 + C_2 \bv_2 \right) \cos(\beta t) +
\left( C_1 i \bv_1 - C_2 i \bv_2 \right) \sin(\beta t)
\right].\label{eqn:linear_system_oscillations}
\end{flalign}
Form the initial conditions we know that $\bx(0) = C_1 \bv_1 + C_2 \bv_2$ and once we have
calculated $C_1$ and $C_2$ it is straight forward to find the vectors multiplying the
cosine and sine terms in the solution.

\begin{example}\label{ex:linear_system_oscillation}
    Solve the system of differential equations 
    \[ \bx'(t) = \begin{pmatrix} -2 & -2 \\ 2 & -2 \end{pmatrix} \bx(t) \]
    with initial condition $\bx(0) = \begin{pmatrix} 3 \\ -3 \end{pmatrix}$. \\
    {\bf Solution:} We first need to find the eigenvalues and eigenvectors of the
    coefficient matrix, $A$.  
    \[ \bv_1 = \begin{pmatrix} -i \\ -1 \end{pmatrix} \quad \text{with} \quad \lambda_1 =
    -2 + 2i \]
    \[ \bv_2 = \begin{pmatrix} i \\ -1 \end{pmatrix} \quad \text{with} \quad \lambda_2 =
    -2 - 2i \]
    Solve the system of equation $\begin{pmatrix} \bv_1 \, \bv_2 \end{pmatrix}
    \begin{pmatrix} C_1 \\ C_2 \end{pmatrix} = \bx(0)$ to get $C_1 = \frac{3}{2} +
    \frac{3}{2} i$ and $C_2 = \frac{3}{2} - \frac{3}{2} i$ (the actual computation is left
    to the reader). 
    Hence,
    \[ C_1 \bv_1 + C_2 \bv_2 = \left( \frac{3}{2} + \frac{3}{2} i \right) \begin{pmatrix}
        -i \\ -1 \end{pmatrix} + \left( \frac{3}{2} - \frac{3}{2}i \right) \begin{pmatrix}
    i \\ -1 \end{pmatrix} = \cdots = \begin{pmatrix} 3 \\ -3 \end{pmatrix}  \]
    and
    \[ C_1i \bv_1 - C_2i \bv_2 = \left( \frac{3}{2} + \frac{3}{2} i \right)i \begin{pmatrix}
        -i \\ -1 \end{pmatrix} - \left( \frac{3}{2} - \frac{3}{2}i \right)i \begin{pmatrix}
    i \\ -1 \end{pmatrix} = \cdots = \begin{pmatrix} 3 \\ 3 \end{pmatrix}  \]
    Now we can substitute into \eqref{eqn:linear_system_oscillations} to get the complete
    solution
    \[ \bx(t) = e^{-2t} \left( \cos(2t) \begin{pmatrix} 3 \\ -3 \end{pmatrix} + \sin(2t)
    \begin{pmatrix} -3 \\ 3 \end{pmatrix} \right) = \begin{pmatrix} e^{-2t} \left( 3
        \cos(2t) + 3 \sin(2t)
    \right) \\ e^{-2t} \left( -3\cos(2t) + 3\sin(2t) \right) \end{pmatrix}. \]
    The solutions to the system are shown in Figure \ref{fig:linear_system_oscillation}
\end{example}

\begin{figure}
    \begin{center}
        \begin{tikzpicture}
            \begin{axis}[axis lines=center, domain=0:3, xmin=0, xmax=3, ymin=-3.1, ymax=3.1,
                xlabel={$t$}]
                \addplot[blue, very thick, samples=100] {exp(-2*x)*(3*cos(2*deg(x)) + 3*sin(2*deg(x)))};
                \addlegendentry{$x(t)$};
                \addplot[red, very thick, samples=100] {exp(-2*x)*(-3*cos(2*deg(x)) + 3*sin(2*deg(x)))};
                \addlegendentry{$y(t)$};
            \end{axis}
        \end{tikzpicture}
    \end{center}
    \caption{Solution curves for Example \ref{ex:linear_system_oscillation}}
    \label{fig:linear_system_oscillation}
\end{figure}




\newpage\section{Trace-Determinant Plane}
In this section we will examine a technique for quickly determining
the behavior of 2D linear systems.  This will play a major role in our nonlinear systems
since each nonlinear system will eventually be linearized as we will see in a bit.  


Recall that if $\bv_1$ and $\bv_2$ are the eigenvectors of $A$ with eigenvalues
$\lambda_1$ and $\lambda_2$ then the solution to the first order linear system of
equations $\bx' = A \bx$ is
\[ \bx = c_1 e^{\lambda_1 t} \bv_1 + c_2 e^{\lambda_2 t} \bv_2 \]
where $\bx_0 = c_1 \bv_1 + c_2 \bv_2$.  Furthermore we observe that $\bx = \bo$ is an
equilibrium point of the system of differential equations.  Use these ideas to answer the
following questions.
\begin{problem}
    Consider the $2\times 2$ linear system of differential equations $\bx'=A\bx$.  In each
    of the following cases what is the expected behavior of the solution? The choices are:
    spirals in to the origin, spirals out from the origin, decays in to the origin,
    diverges out from the origin, decays toward the origin but then diverges out, or
    circles the origin.
            \begin{enumerate}
                \item If $\lambda_1 \le \lambda_2 < 0$ then near the origin the
                    solution \underline{\hspace{1in}}
                    \solution{decays in}
                \item If $\lambda_1 < 0 < \lambda_2$ then near the origin the
                    solution \underline{\hspace{1in}}
                    \solution{decays toward the origin but then divers out}
                \item If $\lambda_1 \ge \lambda_2 > 0$ then near the origin the
                    solution \underline{\hspace{1in}}
                    \solution{diverges out from the origin}
                \item If $\lambda_1, \lambda_2 = \alpha \pm \beta i \, (\alpha<0)$ then
                    near the origin the solution \underline{\hspace{1in}}
                    \solution{spirals in toward the origin}
                \item If $\lambda_1, \lambda_2 = \alpha \pm \beta i \, (\alpha>0)$ then
                    near the origin the solution \underline{\hspace{1in}}
                    \solution{spirals out from the origin}
                \item If $\lambda_1, \lambda_2 = \pm \beta i$ then near the origin
                    the solution \underline{\hspace{1in}}
                    \solution{circles the origin}
            \end{enumerate}
\end{problem}

\begin{problem}
    In the following plots the two eigenvectors for a matrix $A$ are plotted and the
    eigenvalues are given.  Sketch the trajectory of the solution in the $xy$-plane
    starting at the given points (use your answers from the previous problem to help).
    \begin{center}
        \begin{tikzpicture}
            \draw[very thick, <->, black] (-3,0) -- (3,0);
            \draw[very thick, <->, black] (0,-2.5) -- (0,2.5);
            \draw[very thick, red, ->, dashed] (0,0) -- (1,2) node[anchor=south
            west]{$\lambda_1 = -2$}; 
            \draw[very thick, blue, ->, dotted] (0,0) -- (-2,-1) node[anchor=north
            east]{$\lambda_2 = -0.25$}; 
            \draw[fill=black] (1.0,1.0) circle(0.075cm);
            \draw[fill=black] (-1,-1) circle(0.075cm);
            \draw[fill=black] (-1,1) circle(0.075cm);
            \draw[fill=black] (1,-1) circle(0.075cm);
        \end{tikzpicture}\hspace{0.4in}
        \begin{tikzpicture}
            \draw[very thick, <->, black] (-3,0) -- (3,0);
            \draw[very thick, <->, black] (0,-2.5) -- (0,2.5);
            \draw[very thick, red, ->, dashed] (0,0) -- (1,2) node[anchor=south
            west]{$\lambda_1 = 2$}; 
            \draw[very thick, blue, ->, dotted] (0,0) -- (-2,-1) node[anchor=north
            east]{$\lambda_2 = -0.25$}; 
            \draw[fill=black] (1.0,1.0) circle(0.075cm);
            \draw[fill=black] (-1,-1) circle(0.075cm);
            \draw[fill=black] (-1,1) circle(0.075cm);
            \draw[fill=black] (1,-1) circle(0.075cm);
        \end{tikzpicture}
    \end{center}
    \begin{center}
        \begin{tikzpicture}
            \draw[very thick, <->, black] (-3,0) -- (3,0);
            \draw[very thick, <->, black] (0,-2.5) -- (0,2.5);
            \draw[very thick, red, ->, dashed] (0,0) -- (1,2) node[anchor=south
            west]{$\lambda_1 = 2$}; 
            \draw[very thick, blue, ->, dotted] (0,0) -- (-2,-1) node[anchor=north
            east]{$\lambda_2 = 0.25$}; 
            \draw[fill=black] (1.0,1.0) circle(0.075cm);
            \draw[fill=black] (-1,-1) circle(0.075cm);
            \draw[fill=black] (-1,1) circle(0.075cm);
            \draw[fill=black] (1,-1) circle(0.075cm);
        \end{tikzpicture}\hspace{0.4in}
        \begin{tikzpicture}
            \draw[very thick, <->, black] (-3,0) -- (3,0);
            \draw[very thick, <->, black] (0,-2.5) -- (0,2.5);
            \draw[very thick, red, ->, dashed] (0,0) -- (1,2) node[anchor=south
            west]{$\lambda_1 = -2+i$}; 
            \draw[very thick, blue, ->, dotted] (0,0) -- (-2,-1) node[anchor=north
            east]{$\lambda_2 = -2-i$}; 
            \draw[fill=black] (1.0,1.0) circle(0.075cm);
            \draw[fill=black] (-1,-1) circle(0.075cm);
            \draw[fill=black] (-1,1) circle(0.075cm);
            \draw[fill=black] (1,-1) circle(0.075cm);
        \end{tikzpicture}
    \end{center}
    \begin{center}
        \begin{tikzpicture}
            \draw[very thick, <->, black] (-3,0) -- (3,0);
            \draw[very thick, <->, black] (0,-2.5) -- (0,2.5);
            \draw[very thick, red, ->, dashed] (0,0) -- (1,2) node[anchor=south
            west]{$\lambda_1 = 2+i$}; 
            \draw[very thick, blue, ->, dotted] (0,0) -- (-2,-1) node[anchor=north
            east]{$\lambda_2 = 2-i$}; 
            \draw[fill=black] (1.0,1.0) circle(0.075cm);
            \draw[fill=black] (-1,-1) circle(0.075cm);
            \draw[fill=black] (-1,1) circle(0.075cm);
            \draw[fill=black] (1,-1) circle(0.075cm);
        \end{tikzpicture}\hspace{0.4in}
        \begin{tikzpicture}
            \draw[very thick, <->, black] (-3,0) -- (3,0);
            \draw[very thick, <->, black] (0,-2.5) -- (0,2.5);
            \draw[very thick, red, ->, dashed] (0,0) -- (1,2) node[anchor=south
            west]{$\lambda_1 = i$}; 
            \draw[very thick, blue, ->, dotted] (0,0) -- (-2,-1) node[anchor=north
            east]{$\lambda_2 = -i$}; 
            \draw[fill=black] (1.0,1.0) circle(0.075cm);
            \draw[fill=black] (-1,-1) circle(0.075cm);
            \draw[fill=black] (-1,1) circle(0.075cm);
            \draw[fill=black] (1,-1) circle(0.075cm);
        \end{tikzpicture}
    \end{center}
\end{problem}

Now that we know the general behavior of all $2 \times 2$ systems based on the
eigen-structure let's get a faster way to make the determination.  That is, if we can
avoid actually finding the eigenvalues that might save some time.
\begin{problem}
    Let the $2 \times 2$ linear system $\bx' = A \bx$ be written as
    \[ \begin{pmatrix} x' \\ y' \end{pmatrix} = \begin{pmatrix} a & b \\ c & d
        \end{pmatrix} \begin{pmatrix} x \\ y \end{pmatrix} \]
    Your Tasks:
    \begin{enumerate}
        \item What is the equilibrium of this system presuming that $A^{-1}$ exists?
        \item Find the characteristic polynomial of the coefficient matrix
        \item Simplify the characteristic polynomial to fill in the blanks:
            \[ \lambda^2 + \underline{\hspace{0.5in}} \lambda + \underline{\hspace{0.5in}}
                = 0
                \]
            The blanks should be familiar features of the matrix.
    \end{enumerate}
\end{problem}
\solution{
    The solution to the system is $\bx = \bo$ since we solve $\bo = A
    \bx$ to find the equilibrium and if $A^{-1}$ exists then $\bx = \bo$.  

    The characteristic polynomial is:
$p(\lambda) = \lambda^2 - tr(A) \lambda + \det(A) $
}



\begin{problem}
    In the previous problems you found that the characteristic polynomial for a 2D linear
    system is $p(\lambda) = \lambda^2 - T \lambda + D$ where $T = \text{tr}(A)$ and $D=
    \det(A)$.  Solving for $\lambda$ we see that
    \[ \lambda = \frac{T \pm \sqrt{T^2 - 4 D}}{2}. \]
    Clearly the behavior of the eigenvalues depends on the quantity $T^2 - 4D$.  To
    visualize this we create the {\it trace-determinant} plane as seen in the figure
    immediately below.  Fill in the question marks in the figure with the type of behavior
    you expect to see for each region of the {\it trace-determinant} plane?

    To illustrate what we mean condsider the furthest right question mark.  In that
    question mark the determinant, $D$, is greater than zero, the trace, $T$, is greater
    than zero and $D < T^2 / 4$.  Hence $T^2 - 4D>0$ so we expect the behavior of the
    system to be a nodal source since both eigenvalues will be real and positive.

    Use the following words to fill in the question marks: nodal source, nodal sink,
    spiral source, spiral sink, center, and saddle.
\end{problem}
    \vspace{-0.1in}
        \begin{center}
            \begin{tikzpicture}
                \begin{axis}[xlabel={$T=tr(A)$},ylabel={$D=\det(A)$}, ymin=-0.5,
                        ymax=0.5, xmin=-2, xmax=2, xtick=\empty, ytick=\empty, legend pos=outer
                    north east]
                    \addplot[smooth,blue, very thick, domain=-2:2] {(1/4)*x^2};
                    \addlegendentry{$D = T^2/4$};
                    \addplot[smooth, black, thick] {0*x};
                    \draw[black,thick] (axis cs:0,-0.5) -- (axis cs:0,0.5);
                    \node at (axis cs:1.5,0.1) {?};
                    \node at (axis cs:-1.5,0.1) {?};
                    \node at (axis cs:-.5,0.25) {?};
                    \node at (axis cs:.5,0.25) {?};
                    \node at (axis cs:0,0.3) {?};
                    \node at (axis cs:0.5,-0.25) {?};
                    \node at (axis cs:-0.5,-0.25) {?};
                \end{axis}
            \end{tikzpicture}
        \end{center}

\solution{
        \begin{center}
            \begin{tikzpicture}
                \begin{axis}[xlabel={$T=tr(A)$},ylabel={$D=\det(A)$}, ymin=-0.5,
                        ymax=0.5, xmin=-2, xmax=2, xtick=\empty, ytick=\empty, legend pos=outer
                    north east]
                    \addplot[smooth,blue, very thick, domain=-2:2] {(1/4)*x^2};
                    \addlegendentry{$D = T^2/4$};
                    \addplot[smooth, black, thick] {0*x};
                    \draw[black,thick] (axis cs:0,-0.5) -- (axis cs:0,0.5);
                    \node at (axis cs:1.5,0.1) {\tiny{nodal source}};
                    \node at (axis cs:-1.5,0.1) {\tiny{nodal sink}};
                    \node at (axis cs:-.5,0.25) {\tiny{spiral sink}};
                    \node at (axis cs:.5,0.25) {\tiny{spiral source}};
                    \node at (axis cs:0,0.3) {\tiny{center}};
                    \node at (axis cs:0.5,-0.25) {\tiny{saddle}};
                    \node at (axis cs:-0.5,-0.25) {\tiny{saddle}};
                \end{axis}
            \end{tikzpicture}
        \end{center}
    }


\begin{problem}
    In a 2D linear system of differential equations $\bx' = A \bx$ we know that the origin
    is the only equilibrium if the matrix $A$ is invertible (you should pause and prove
    this).  For each of the following systems, describe the behaviour of the solution
    curves near the origin.  Use the Trace-Determinant Plane to find your answers, and
    then justify your conclusions by actually finding the eigenvalues using the
    characteristic polynomial equation $\lambda^2 - T \lambda + D=0$.
    \begin{enumerate}
        \item[(a)] $\bx' = A \bx$ with $\text{trace}(A) = 1$ and $\det(A) = 9$
            \solution{$D>T^2/4$, $D>0$, and $T>0$ so we must have a spiral source}
        \item[(b)] $\bx' = A \bx$ with $\text{trace}(A) = 9$ and $\det(A) = 1$
            \solution{$D<T^2/4$, $D>0$, and $T>0$ so we must have a source}
        \item[(c)] $\bx' = A \bx$ with $\text{trace}(A) = -9$ and $\det(A) = 1$
            \solution{$D<T^2/4$, $D>0$, and $T<0$ so we must have a sink}
        \item[(d)] $\bx' = A \bx$ with $\text{trace}(A) = -1$ and $\det(A) = 9$
            \solution{$D>T^2/4$, $D>0$, and $T<0$ so we must have a spiral sink}
        \item[(e)] $\bx' = A \bx$ with $\text{trace}(A) = -1$ and $\det(A) = -9$
            \solution{Since $D<0$ we must have a saddle}
        \item[(f)] $\bx' = A \bx$ with $\text{trace}(A) = 1$ and $\det(A) = -9$
            \solution{Since $D<0$ we must have a saddle}
    \end{enumerate}
\end{problem}



% \newpage\section{Additional Exercises}
% \begin{problem}
%     Write code for 2D and 3D versions of Euler's method and the Runge-Kutta 4 method.
%     Test them on problems where you know the analytic solution.
% \end{problem}
% 
% \begin{problem}
%     One day it started snowing at a constant rate. Three identical snowplows started at
%     noon, 1pm, and 2pm from the same place, and began plowing down a long straight road.
%     All three plows collided at the same time. Assuming that plowing rates are always
%     inversely proportional to the snow depth, show that the snow started falling at 11:30.
%     \begin{enumerate}
%         \item[(a)] Why does it make sense to say that the plow rates are inversely
%             proportional to the snow depth?
%         \item[(b)] Which will be easier: writing differential equations in terms of the
%             position of the plows as functions of time; or writing differential equations
%             in terms of the time each plow has traveled as functions of position?  Why?
%         \item[(c)] Write the differential equations for the model you chose in part (b)
%             and solve the model.  Verify that the collision occurs at 11:30.
%     \end{enumerate}
% \end{problem}
